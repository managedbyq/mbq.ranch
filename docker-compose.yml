---
version: '3'

services:
  py36:
    build:
      context: .
      args:
        IMAGE: 'python:3.6-stretch'
    volumes:
      - .:/app
    links:
      - ranch-postgres
    environment:
      TOX_WORK_DIR: /tox
      PYTHON_VERSION: py36

  py37:
    build:
      context: .
      args:
        IMAGE: 'python:3.7-stretch'
    volumes:
      - .:/app
    links:
      - ranch-postgres
    environment:
      TOX_WORK_DIR: /tox
      PYTHON_VERSION: py37

  test-admin:
    build:
      context: .
      args:
        IMAGE: 'python:3.7.1-slim-stretch'
        INSTALL_DJANGO: 'TRUE'
    volumes:
      - .:/app
    links:
      - ranch-postgres
    ports:
      - '8080:8080'
    command: [python, -m, manage, runserver, '0.0.0.0:8080']

  ranch-postgres:
    image: postgres:9.6.8
    environment:
      POSTGRES_DB: ranch
